---
import Layout from '../../../layouts/Layout.astro';
import fs from 'fs';
import path from 'path';
import matter from 'gray-matter';

const postsDirectory = path.resolve('./src/content/blog');

export async function getStaticPaths() {
  const files = fs.readdirSync(postsDirectory).filter(f => f.endsWith('.md'));

  return files.map((file) => {
    const slug = file.replace('.md', '');
    return { params: { slug } };
  });
}

const { slug } = Astro.params;
const filePath = path.join(postsDirectory, `${slug}.md`);
const raw = fs.readFileSync(filePath, 'utf-8');
const { content, data } = matter(raw);
---

<Layout title={data.title}>
  <article>
    <h1>{data.title}</h1>
    <p><em>{data.date}</em></p>
    <div innerHTML={Astro.markdown(content)} />
  </article>
</Layout>
